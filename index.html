<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Brewstore</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon"
      type="image/png"
      href="scripts/Components/Logo/assets/logo.png">

    <link rel="stylesheet" href="Reset.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/
    css'>

    <link href='https://fonts.googleapis.com/css?family=Slabo+27px' rel='stylesheet' type='text/css'>

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500' rel='stylesheet' type='text/css'>

    <link rel="manifest" href='manifest.json' type='text/json'>

    <template id="side-navbar-template">
        <style>
            nav {
                position: fixed;
                top: 0;
                left: 0;
                width: 260px;
                height: 100%;
                background: #FFFFFF;
                box-shadow: 1px 0 4px rgba(0, 0, 0, .8);
                z-index: 2;
                transform: translateX(-102%);
                transition: transform .3s;
                will-change: transform;
            }
            .container.is-moving nav,
            .container.is-moving .overlay {
                transition: none;
            }

            .overlay {
                opacity: 0;
            }

            header {
                height: 150px;
                background: #f04e0d;
            }
            .header-text {
                color: #fff;
                font-weight: bold;
                font-size: 1.1em;
                margin: 0;
            }
            main {
                padding: 4px 0;
                display: flex;
                flex-direction: column;
            }
            .link {
                height: 40px;
                cursor: pointer;
                display: flex;
                text-decoration: none;
                font-weight: bold;
                color: #000;
                align-items: center;
                position: relative;
                padding-left: calc(.5em + 15px);
            }
            .link:focus {
                outline: none;
            }
            .link:hover::before,
            .link:focus::before {
                content: 'â–¸ ';
                display: block;
                width: 15px;
                position: absolute;
                left: .5em;
            }
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1;
                width: 100%;
                height: 100%;
                background: #000;
                transition: opacity .3s;
                will-change: opacity;
            }
            .container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 99;
                pointer-events: none;
                transition: opacity 0s;
            }
            .container.visible {
                pointer-events: auto;
            }
            .container:not(.visible) {
                transition-delay: .5s;
                /*opacity: 0;*/
            }

            .container.visible {
                opacity: 1;
            }
            .container.visible nav {
                transform: translateX(0);
            }
            .container.visible .overlay {
                opacity: .54;
            }

            .slider {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                width: 30px;
            }
        }
        </style>


        <div>
            <div class="container">
                <nav>
                    <header>
                        <h1 class="header-text"></h1>
                    </header>

                    <main>
                        <a class="link" href="/#/recipes">Recipes</a>
                        <a class="link" href="/#/settings">Settings</a>
                        <a class="link" href="/#/about">About</a>
                    </main>
                </nav>


                <div class="overlay"></div>
            </div>
            <div class="slider"></div>
        </div>
    </template>

    <script>

    // navbar
    ;(() => {
        let container;
        let root;
        let overlay;
        let slider;
        let nav;
        let something;
        document.registerElement('side-navbar', {
            prototype: Object.create(HTMLElement.prototype, {
                createdCallback: {
                    value: function() {
                        const t = document.querySelector('#side-navbar-template');
                        const clone = document.importNode(t.content, true);
                        root = this.createShadowRoot();
                        root.appendChild(clone);
                        something = this;
                    }
                },
                attachedCallback: {
                    value: function () {
                        slider = root.querySelector('.slider');
                        container = root.querySelector('.container');
                        overlay = root.querySelector('.overlay');
                        nav = root.querySelector('nav');

                        if (this.attributes.hasOwnProperty('visible') && this.attributes['visible'] === 'true') {
                            setVisible();
                        }

                        root.addEventListener('click', setHidden);

                        // window.getComputedStyle(nav).getPropertyValue('width')
                        const maxPos = 260;
                        const maxOpacity = 0.54;
                        let lastPos = 0;
                        let hhhh;
                        const inertiaDeltaConstant = 10;
                        const inertiaTimeConstantInMs = 200;
                        let touchTimeStart;
                        let touchTimeEnd;

                        function moveDelta(ev) {
                            const pos = ev.touches[0].pageX;
                            if (pos > maxPos) {
                                return;
                            }

                            const delta = hhhh - pos;
                            hhhh = pos;
                            setPosDelta(lastPos, -delta);
                        }

                        container.addEventListener('touchstart', (touchStartEvent) => {
                            if (something.attributes.visible.value === 'false') {
                                return;
                            }
                            container.classList.add('is-moving');
                            hhhh = 0;
                            container.addEventListener('touchmove', moveDelta);
                        });

                        container.addEventListener('touchend', (ev) => {
                            if (something.attributes.visible.value === 'false') {
                                return;
                            }
                            hhhh = 0;
                            container.classList.remove('is-moving');
                            snap(lastPos);
                            container.removeEventListener('touchmove', moveDelta);
                        });


                        function setVisible() {
                            if (something.attributes.visible.value === 'true') {
                                return;
                            }

                            something.attributes.visible.value = 'true';
                            container.classList.add('visible');

                            lastPos = maxPos;
                        }
                        function setHidden() {
                            if (something.attributes.visible.value === 'false') {
                                return;
                            }

                            lastPos = 0;
                            something.attributes.visible.value = 'false';
                            container.classList.remove('visible');
                        }

                        function setPosDelta(initialPos, delta) {
                            const pos = initialPos + delta;
                            setPos(pos);
                        }

                        function setPos(pos) {
                            if (pos > maxPos) {
                                return;
                            }
                            lastPos = pos;

                            overlay.style.opacity = (pos / maxPos) * maxOpacity;
                            nav.style.transform = `translateX(calc(-100% + ${ pos }px))`;
                        }

                        function moveMenu(ev, offset = 0) {
                            const pos = ev.touches[0].pageX;
                            setPos(pos + offset);
                        }

                        function snap(pos) {
                            nav.style.transform = '';
                            overlay.style.opacity = '';
                            if (pos > (maxPos * 0.5)) {
                                setVisible()
                            }
                            else {
                                setHidden();
                            }
                        }

                        slider.addEventListener('touchstart', () => {
                            if (something.attributes.visible.value === 'true') {
                                return;
                            }

                            container.classList.add('is-moving');
                            slider.addEventListener('touchmove', moveMenu);
                        });

                        slider.addEventListener('touchend', (ev) => {
                            if (something.attributes.visible.value === 'true') {
                                return;
                            }

                            container.classList.remove('is-moving');
                            snap(lastPos);
                            slider.removeEventListener('touchmove', moveMenu);
                        });
                    }
                },
                attributeChangedCallback: {
                    value: function(attrName, oldVal, newVal) {
                        switch(attrName) {
                            case 'visible': {
                                if (newVal === 'true') {
                                    container.classList.add('visible');
                                }
                                else {
                                    container.classList.remove('visible');
                                }
                            }
                        }
                    }
                }
            })
        });
    })();


    // hamburger
    function onHamburgerClick() {
        const navbar = document.querySelector('side-navbar');
        if (navbar.attributes.visible.value === 'true') {
            navbar.attributes.visible.value = 'false';
        }
        else {
            navbar.attributes.visible.value = 'true';
        }
    }
    </script>

    <style>
        #ham {
            background: #fff url(/images/ic_menu_black_24px.svg) center center no-repeat;
            width: 40px;
            height: 40px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .1);
            cursor: pointer;
        }
        #ham:active:hover {
            position: relative;
            top: 3px;
            height: 37px;
            margin-bottom: 3px;
        }
    </style>
</head>
<body>
    <main>
        <div>
            <button id="ham" onClick="onHamburgerClick()"></button>
            <side-navbar visible="false"></side-navbar>
        </div>
        <div id="container">
            Loading...
        </div>
    </main>

    <script src="offline.js"></script>
    <script src="bundle.js"></script>
</body>
</html>
